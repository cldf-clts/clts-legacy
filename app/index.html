<html>
<head>
  <title>CLTS browser</title>
  <meta name="robots" content="noindex">
  <meta name="viewport" content="user-scalable=no,width=device-width,initial-scale=1">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <script src="data.js" type="text/javascript"></script>
  <script src="script.js" type="text/javascript"></script>
  <link rel="icon" href="favicon.png" type="image/png"> 
  <link rel="stylesheet" type="text/css" href="style.css" />
  <link rel="stylesheet" type="text/css" href="site.css" />
</head>
<style>
td {
  border: 1px solid lightgray;
  padding: 5px;
}
</style>
<body class="site">
  <header class="site-header" style="background-color: #2d6ca2;">
    <nav>
    <div class="sticky-nav"  style="background-color: #2d6ca2;">
    <div class="container-nav">
       <div class="nav-container"  style="background-color: #2d6ca2;" >
         <div class="navbar-brand"> <a href="">  <img style="width:200px" src="ipa-logo.png" alt="CLTS-LOGO"></a> </div>
         <div class="navbar-nav nav-mobile">
          
            <a class="nav-item nav-link btn btn-nav" href="">Home</a>
            <a class="nav-item nav-link btn btn-nav" href="">GitHub</a>
            <a class="nav-item nav-link btn btn-nav" href="http://calc.digling.org">BACK</a>
                    
         </div>
         <div class="navbar-nav nav-main">
           <a class="nav-item nav-link active" href="">Home</a>
           <a href="" class="nav-item nav-link">GitHub</a>
           <a href="http://calc.digling.org" class="nav-item nav-link">BACK</a>
                    
         </div>
      </div>  
      </div>
      </div>
</nav>
</header>
<main class="site-content">
<section class="section-main">
  <div class="container">
  <h2 class="headline" style="color:black;">Cross-Linguistic Transcription Systems</h1>
  <p>Just paste or type your text in space-separated form in the text-area field below to test it.</p>
  <p><textarea style="background-color:lightyellow;" onkeyup="document.getElementById('annotation').innerHTML='';convertCLPA(this.value)"
	    id="input" cols="80" rows="8" 
    placeholder="type your phonetic code here, separating sound segments by spaces"></textarea>
  </p>
  <br>
  <p>
  <div id="annotation"></div></p>
  </div>
</section>

<script>
function showUnicode(strings) {
  var ucode = get_unicodes(strings);
  var utext = [];
  for (var i=0, k; k=ucode[0][i]; i++) {
    utext.push(ucode[0][i]+'<sup>'+ucode[1][i]+'</sup>');
  }
  document.getElementById(strings).innerHTML = utext.join(' ');
}
function showOriginal(idf) {
  document.getElementById(idf).innerHTML = idf;
}

function convertCLPA(value) {
  document.getElementById('annotation').innerHTML = '';
  var segments = value.normalize('NFD').split(/\s+/);
  console.log("segments", segments);
  var table = [];
  var visited = [];
  var freqs = {};
  var symbols = [];
  for (var i=0,segment; segment=segments[i]; i++) {
    if (segment in BIPA) {
      var ssegment = segment;
    }
    else {
      var normalized = '';
      for (var j=0,c; c=segment[j]; j++) {
	if (c in normalize){
	  normalized += normalize[c];
	}
	else {
	  normalized += c;
	}
      }
      var ssegment = normalized;
    }
	  
    if (ssegment in BIPA) {
      var tmp = BIPA[ssegment];
      if (visited.indexOf(tmp['bipa']) == -1) {
	freqs[tmp['bipa']] = 1;
	visited.push(tmp['bipa']);
      	var cls = tmp['type'];
	var alias = '';
	var alias_color = 'white';
	
	if (tmp['bipa'] != ssegment) {
	  alias = ssegment;
	  alias_color = 'lightyellow';
	}
	var normed = '';
	var normed_color = 'white';
	if (ssegment != segment) {
	  normed = segment;
	  normed_color = 'lightyellow';
	}

	var phoible = '';
	var phoible_color = 'white';
	if ('phoible_id' in tmp) {
	  phoible = '<a target="_blank" style="color:Crimson" href="http://phoible.org/parameters/' + 
	    tmp['phoible_id'] + '">' + tmp['phoible_grapheme']+'</a>';
	  if (tmp['phoible_grapheme'] != tmp['bipa']) {
	    phoible_color = 'lightblue';
	  }
	}
	  
      	var tabletext = '<td title="click to show unicode" id="'+tmp['bipa'] + 
	  '" onclick="showUnicode(\''+tmp['bipa']+'\');" ondblclick="showOriginal(\''+
	  tmp['bipa']+'\');">'+tmp['bipa']+'</td>';
	if (normed) {
	  tabletext += '<td title="click to show unicode" id="'+normed+'" onclick="showUnicode(\''+normed+'\');" '+ 
	    'ondblclick="showOriginal(\''+normed+'\');" '+
	    'style="background-color:'+normed_color+'">'+normed+'</td>';
	}
	else {
	  tabletext += '<td></td>';
	}
	if (alias) {
	  tabletext += '<td id="'+alias+'" title="click to show unicode" onclick="showUnicode(\''+alias+'\');" '+ 
	    'ondblclick="showOriginal(\''+alias+'\');" '+
	    'style="background-color:'+alias_color+'">'+alias+'</td>';
	}
	else {
	  tabletext += '<td></td>';
	}
      	tabletext += '<td>'+cls+'</td>';
      	tabletext += '<td>'+tmp['name'].replace(' '+tmp['type'], '')+'</td>';
	tabletext += '<td style="background-color:'+phoible_color+'">'+phoible+'</td>';
      	table.push([tmp['name'], tmp['bipa'], tabletext]);
	symbols.push(ssegment);
      }
      else {
	freqs[tmp['bipa']] += 1;
      }
    }
    else if (typeof ssegment != 'undefined' && ssegment.length > 0 && ssegment.replace(/\s/g,'') != ''){
      if (visited.indexOf(ssegment) == -1) {
	visited.push(ssegment);
	table.push(['?', ssegment, 
	  '<td title="click to show unicode" id="'+ssegment+'"' + 
	  'onclick="showUnicode(\''+ssegment+'\');" ondblclick="showOriginal(\''+ssegment+'\');" '+
	  'colspan="6" style="color:red;font-weight:bold">'+segment+'</td>']);
	freqs[ssegment] = 1;
      }
      else {
	freqs[ssegment] += 1;
      }
    }
  }
  var ttext = '<table style="border:2px solid black;">'
    + '<tr style="border:2px solid gray;">'
    + '<th>BIPA</th><th>NORM</th><th>ALIAS</th><th>TYPE</th><th>NAME</th><th>PHOIBLE</th><th>OCC</th></tr>';
  /* sort the table according to the reverse name */
  table.sort(function (x, y) {
    if (x[0].split("").reverse().join("") < y[0].split("").reverse().join("")) {
      return -1}
    if (x[0].split("").reverse().join("") > y[0].split("").reverse().join("")) {
      return 1}
    return 0;
  });

  for (var i=0,row; row=table[i]; i++) {
    ttext += '<tr>'+table[i][2]+'<td>'+freqs[table[i][1]]+'</td></tr>';
  }
  ttext += '</table>';
  if (table.length > 0) {
    document.getElementById('annotation').innerHTML = ttext;
  }
}
</script>

<div class="footer" style="background-color: #2d6ca2;"> <div class="footerchild"> <a href=""><img src="European_Research_Council_logo.svg" alt="erc-logo" style="width:100px;"/></a></div> <div class="footerchild"> <p> Last updated on {last_update}.  </p> <p> <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png"></a><br><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/InteractiveResource" property="dct:title" rel="dct:type">This website</span> by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Johann-Mattis List</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" style="color:white">Creative Commons Attribution-NonCommercial 4.0 International License</a>.  </p><p><a style="color:white;" href="http://www.shh.mpg.de/2417/imprint">IMPRINT</a></p> </div> <div class="footerchild"> <a href="http://www.shh.mpg.de/375796/calc"> <img src="max-planck-logo.svg" alt="mpi-logo" style="width:100px;"/></a></div> </div> 
</body>
</html>
